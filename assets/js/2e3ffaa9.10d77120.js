"use strict";(self.webpackChunktouchgfx_documentation=self.webpackChunktouchgfx_documentation||[]).push([[22028],{49613:(e,t,n)=>{n.d(t,{Zo:()=>h,kt:()=>m});var a=n(59496);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},h=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,h=l(e,["components","mdxType","originalType","parentName"]),p=s(n),u=r,m=p["".concat(c,".").concat(u)]||p[u]||d[u]||o;return n?a.createElement(m,i(i({ref:t},h),{},{components:n})):a.createElement(m,i({ref:t},h))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},93822:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(59496),r=n(96151);const o=a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},a.createElement("path",{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}));class i extends a.Component{render(){return a.createElement(r.Z,{color:"var(--highlight-color-caution)",header:"Caution",type:"caution",icon:o},this.props.children)}}const l=i},89639:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(59496),r=n(7029);const o=function(e){const t=e.noShadow||!1,n=e.width,o=e.height,i=(0,r.Z)(e.imageSource);return t?a.createElement("div",{className:"figure noshadow"},a.createElement("a",{href:i,target:"_blank"},a.createElement("img",{width:n,height:o,src:i})),a.createElement("p",null,e.children)):a.createElement("div",{className:"figure"},a.createElement("a",{href:i,target:"_blank"},a.createElement("img",{width:n,height:o,src:i})),a.createElement("p",null,e.children))}},96151:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(59496);class r extends a.Component{render(){const e=`highlight highlight-${this.props.type}`;return a.createElement("div",{className:e},a.createElement("div",{className:"highlight-heading"},a.createElement("h5",null,a.createElement("div",{className:"highlight-icon"},this.props.icon),this.props.header)),a.createElement("div",{className:"highlight-content"},this.props.children))}}const o=r},49018:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(59496),r=n(96151);const o=a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},a.createElement("path",{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}));class i extends a.Component{render(){return a.createElement(r.Z,{color:"var(--highlight-color-note)",header:"Note",type:"note",icon:o},this.props.children)}}const l=i},16892:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>h,default:()=>f,frontMatter:()=>s,metadata:()=>p,toc:()=>u});n(59496);var a=n(49613),r=n(89639),o=n(49018),i=n(93822);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l.apply(this,arguments)}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const s={id:"scenarios-ltdc-parallel-rgb",title:"LTDC/Parallel RGB"},h=void 0,p={unversionedId:"development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb",id:"development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb",title:"LTDC/Parallel RGB",description:"For MCUs with a TFT controller (e.g. STM32F429, STM32F746, STM32H7), the TouchGFX Generator can generate the part of the HAL that configures the LTDC to transfer pixels from the framebuffer memory to the display.",source:"@site/docs/development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb.mdx",sourceDirName:"development/touchgfx-hal-development/scenarios",slug:"/development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb",permalink:"/4.24/docs/development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb",draft:!1,tags:[],version:"current",frontMatter:{id:"scenarios-ltdc-parallel-rgb",title:"LTDC/Parallel RGB"},sidebar:"docs",previous:{title:"Scenarios",permalink:"/4.24/docs/category/scenarios"},next:{title:"FMC and SPI Display Interface",permalink:"/4.24/docs/development/touchgfx-hal-development/scenarios/scenarios-fmc"}},d={},u=[{value:"Display Interface",id:"display-interface",level:3},{value:"Reading settings from STM32CubeMX",id:"reading-settings-from-stm32cubemx",level:2},{value:"TouchGFX Driver / VSYNC Signal",id:"touchgfx-driver--vsync-signal",level:2},{value:"LTDC Frame Buffer configuration",id:"ltdc-frame-buffer-configuration",level:2},{value:"Conclusion",id:"conclusion",level:2}],m={toc:u},g="wrapper";function f(e){var{components:t}=e,n=c(e,["components"]);return(0,a.kt)(g,l({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"For MCUs with a TFT controller (e.g. STM32F429, STM32F746, STM32H7), the ",(0,a.kt)("em",{parentName:"p"},"TouchGFX Generator")," can generate the part of the HAL that configures the LTDC to transfer pixels from the framebuffer memory to the display.\nThe generated code both starts the correct framebuffer transfer and unblocks the TouchGFX Engine main loop by calling ",(0,a.kt)("inlineCode",{parentName:"p"},"OSWrappers::signalVSync()")," once a VSYNC interrupt is raised by the LTDC."),(0,a.kt)("h3",l({},{id:"display-interface"}),"Display Interface"),(0,a.kt)("p",null,'As opposed to a "Custom" display interface, where the developer must implement the whole driver by hand, for LTDC the TouchGFX Generator can generate all the code necessary for the TouchGFX HAL to support an LTDC configuration.'),(0,a.kt)("p",null,'For "Parallel RGB (LTDC)" to be a selectable option through the TouchGFX Generator the ',(0,a.kt)("em",{parentName:"p"},"LTDC")," must be enabled from the ",(0,a.kt)("em",{parentName:"p"},"Multimedia")," group in the STM32CubeMX category list."),(0,a.kt)(r.Z,{noShadow:!0,imageSource:"/img/development/touchgfx-hal-development/touchgfx-generator/ltdc-modes.webp",mdxType:"Figure"}),(0,a.kt)("p",null,"Once LTDC is enabled, the ",(0,a.kt)("em",{parentName:"p"},"Parallel RGB (LTDC)")," option\xa0becomes available through the ",(0,a.kt)("em",{parentName:"p"},"Display")," section of the TouchGFX Generator."),(0,a.kt)(r.Z,{noShadow:!0,imageSource:"/img/development/touchgfx-hal-development/touchgfx-generator/display-if-options.webp",mdxType:"Figure"}),(0,a.kt)("p",null,"Even after LTDC is enabled through STM32CubeMX, some work is required in order to:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Configure LTDC (GPIO and timings) to match connected display specifications"),(0,a.kt)("li",{parentName:"ol"},"Configure LTDC to match desired TouchGFX application specifications.")),(0,a.kt)("p",null,"The TouchGFX Generator can read various configurations from STM32CubeMX and provide a list of warnings, recommendations or errors that are called ",(0,a.kt)("em",{parentName:"p"},"Dependencies"),". The image below shows the list of dependencies present when initially enabling LTDC in CubeMX for any MCU (in this example we used an F429):"),(0,a.kt)(r.Z,{noShadow:!0,imageSource:"/img/development/touchgfx-hal-development/scenarios/ltdc-dependencies.webp",mdxType:"Figure"}),(0,a.kt)(o.Z,{mdxType:"Note"},"LTDC recommendations, warnings and errors will be visible in the TouchGFX Generator interface as soon as LTDC is enabled through STM32CubeMX."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",l({parentName:"tr"},{align:null}),"Dependency"),(0,a.kt)("th",l({parentName:"tr"},{align:null}),"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",l({parentName:"tr"},{align:null}),"Number of layers"),(0,a.kt)("td",l({parentName:"tr"},{align:null}),"TouchGFX is only capable of utilizing a single layer. While TouchGFX applications can work with two layers enabled, this is a warning to the user that the LTDC is potentially misconfigured. Change the number of layers in the LTDC block.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",l({parentName:"tr"},{align:null}),"Window position"),(0,a.kt)("td",l({parentName:"tr"},{align:null}),"By default, the Horizontal and Vertical window positions of the LTDC layer are 0. The window Horizontal and Vertical stop must be set equal to the displays dimensions.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",l({parentName:"tr"},{align:null}),"Alpha Constant is 0"),(0,a.kt)("td",l({parentName:"tr"},{align:null}),"By default, the alpha constant of LTDC layers is 0. This should be > 0 and preferably 255 unless there is an intent to have a global alpha at all times in an application.")))),(0,a.kt)("p",null,"Remember to actually select the Parallel RGB (LTDC) display interface\nafter enabling the LTDC peripheral in the Multimedia section."),(0,a.kt)(r.Z,{noShadow:!0,imageSource:"/img/development/touchgfx-hal-development/touchgfx-generator/dependencies.webp",mdxType:"Figure"}),(0,a.kt)("p",null,"The following image shows the LTDC configuration that satisfies the conditions of the warnings, causing the Dependencies group to disappear from the TouchGFX Generator interface."),(0,a.kt)(r.Z,{noShadow:!0,imageSource:"/img/development/touchgfx-hal-development/touchgfx-generator/ltdc-config.webp",mdxType:"Figure"}),(0,a.kt)("h2",l({},{id:"reading-settings-from-stm32cubemx"}),"Reading settings from STM32CubeMX"),(0,a.kt)("p",null,"By selecting ",(0,a.kt)("em",{parentName:"p"},"Parallel RGB (LTDC)")," as the display interface through TouchGFX Generator, the ",(0,a.kt)("em",{parentName:"p"},"width")," and ",(0,a.kt)("em",{parentName:"p"},"height")," of the framebuffer is inherited from the LTDC configuration ",(0,a.kt)("em",{parentName:"p"},"horizontal start/stop")," and ",(0,a.kt)("em",{parentName:"p"},"vertical start/stop"),"."),(0,a.kt)(r.Z,{noShadow:!0,imageSource:"/img/development/touchgfx-hal-development/touchgfx-generator/ltdc-window-position.webp",mdxType:"Figure"}),(0,a.kt)("p",null,"Defining the dimensions of Layer ",(0,a.kt)("em",{parentName:"p"},"0")," according to the display and application dimensions a new entry in the ",(0,a.kt)("em",{parentName:"p"},"Dependency")," window appears."),(0,a.kt)(r.Z,{noShadow:!0,imageSource:"/img/development/touchgfx-hal-development/touchgfx-generator/dependency-ltdc-image.webp",mdxType:"Figure"}),(0,a.kt)("p",null,"Ensuring that Framebuffer ",(0,a.kt)("em",{parentName:"p"},"Image Width")," and ",(0,a.kt)("em",{parentName:"p"},"Image Height")," match the size of the window, which is usually desired, will satisfy the warning."),(0,a.kt)(r.Z,{noShadow:!0,imageSource:"/img/development/touchgfx-hal-development/touchgfx-generator/ltdc-config-fixed.webp",mdxType:"Figure"}),(0,a.kt)(i.Z,{mdxType:"Caution"},"TouchGFX Generator inherits the ",(0,a.kt)("b",null,"Width")," and ",(0,a.kt)("b",null,"Height")," values from the LTDC configuration, if LTDC is enabled. However, ",(0,a.kt)("b",null,"Width")," and ",(0,a.kt)("b",null,"Height")," can still be modified from the TouchGFX Generator interface. Changing these values can lead to a configuration mismatch if they do mot respect the Window LTDC Layer configuration."),(0,a.kt)("h2",l({},{id:"touchgfx-driver--vsync-signal"}),"TouchGFX Driver / VSYNC Signal"),(0,a.kt)("p",null,"Once ",(0,a.kt)("em",{parentName:"p"},"Parallel RGB (LTDC)")," is selected as Display Interface, developers gain access to the ",(0,a.kt)("em",{parentName:"p"},"LTDC")," Application Tick Driver or TouchGFX Driver."),(0,a.kt)(r.Z,{noShadow:!0,imageSource:"/img/development/touchgfx-hal-development/scenarios/ltdc-application-tick-source.webp",width:"500",mdxType:"Figure"}),(0,a.kt)("p",null,"The following code is the interrupt handler (STM32F7) for the LTDC interrupt generated according to LTDC configuration. The generated handler automatically unblocks the TouchGFX Engine main loop."),(0,a.kt)("pre",null,(0,a.kt)("code",l({parentName:"pre"},{className:"language-cpp",metastring:"{11}","{11}":!0}),'extern "C"\nirq void LTDC_IRQHandler(void)\n{\n    if (LTDC->ISR & 1)\n    {\n        LTDC->ICR = 1;\n        if (LTDC->LIPCR == (LTDC->AWCR & 0x7FF) - 1)\n        {\n            //entering active area\n            OSWrappers::signalVSync();\n        }\n    }\n}\n')),(0,a.kt)(o.Z,{mdxType:"Note"},"For the LTDC driver to work, users must enable the LTDC global interrupt through the LTDC NVIC settings or through Global NVIC settings, and also enable generation of handler code."),(0,a.kt)(r.Z,{noShadow:!0,imageSource:"/img/development/touchgfx-hal-development/touchgfx-generator/nvic-global-interrupt-enable.webp",mdxType:"Figure"}),(0,a.kt)("h2",l({},{id:"ltdc-frame-buffer-configuration"}),"LTDC Frame Buffer configuration"),(0,a.kt)("p",null,"The generated TouchGFX HAL will automatically configure the LTDC Layer\nColor Frame Buffer Start Address at runtime, so you should not set a\nvalue in LTDC configuration."),(0,a.kt)("h2",l({},{id:"conclusion"}),"Conclusion"),(0,a.kt)("p",null,"Enabling the ",(0,a.kt)("em",{parentName:"p"},"Parallel RGB (LTDC)")," display interface option through TouchGFX Generator allows all required HAL code to be generated."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Sets the width, height and pixel format of the TouchGFX application in accordance with the STM32CubeMX LTDC configuration. The LTDC layer ",(0,a.kt)("em",{parentName:"li"},"width")," and ",(0,a.kt)("em",{parentName:"li"},"height")," impact the size of the canvas in TouchGFX Designer and the LTDC Pixel Format impacts the required TouchGFX framebuffer driver and also the format for generated assets."),(0,a.kt)("li",{parentName:"ul"},"Allow the LTDC application tick source to be selected which generates a handler to drive the TouchGFX Engine Main loop. Usually, with LTDC Configurations developers would always use the provided Application Tick Driver.")))}f.isMDXComponent=!0}}]);